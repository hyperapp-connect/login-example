var app=function(e){"use strict";function t(e,t){for(var n=[],r=[],o=arguments.length;o-- >2;)n.push(arguments[o]);for(;n.length;){var i=n.pop();if(i&&i.pop)for(o=i.length;o--;)n.push(i[o]);else null!=i&&!0!==i&&!1!==i&&r.push(i)}return"function"==typeof e?e(t||{},r):{nodeName:e,attributes:t||{},children:r,key:t&&t.key}}function n(e){return e.protocol+"//"+e.hostname+(e.port?":"+e.port:"")}function r(e){return n(location)!==n(e)}function o(e,n){return function(o,i){var u=e.to,a=o.location,l=e.onclick;return delete e.to,delete e.location,e.href=u,e.onclick=function(t){l&&l(t),t.defaultPrevented||0!==t.button||t.altKey||t.metaKey||t.ctrlKey||t.shiftKey||"_blank"===e.target||r(t.currentTarget)||(t.preventDefault(),u!==a.pathname&&history.pushState(a.pathname,"",u))},t("a",e,n)}}function i(e,t,n,r){return{isExact:e,path:t,url:n,params:r}}function u(e){for(var t=e.length;"/"===e[--t];);return e.slice(0,t+1)}function a(e){try{return decodeURIComponent(e)}catch(t){return e}}function l(e){return function(t,n){var r=t.location,o=function(e,t,n){if(e===t||!e)return i(e===t,e,t);var r=n&&n.exact,o=u(e).split("/"),l=u(t).split("/");if(!(o.length>l.length||r&&o.length<l.length)){var s=0,c={},p=o.length;for(t="";s<p;s++){if(":"===o[s][0])c[o[s].slice(1)]=l[s]=a(l[s]);else if(o[s]!==l[s])return;t+=l[s]+"/"}return i(!1,e,t.slice(0,-1),c)}}(e.path,r.pathname,{exact:!e.parent});return o&&e.render({match:o,location:r})}}var s={state:{pathname:window.location.pathname,previous:window.location.pathname},actions:{go:function(e){history.pushState(null,"",e)},set:function(e){return e}},subscribe:function(e){function t(t){e.set({pathname:window.location.pathname,previous:t.detail?window.location.previous=t.detail:window.location.previous})}var n=["pushState","replaceState"].reduce(function(e,t){var n=history[t];return history[t]=function(e,t,r){n.call(this,e,t,r),dispatchEvent(new CustomEvent("pushstate",{detail:e}))},function(){history[t]=n,e&&e()}},null);return addEventListener("pushstate",t),addEventListener("popstate",t),function(){removeEventListener("pushstate",t),removeEventListener("popstate",t),n()}}};const c=(...e)=>console.error(...e),p=e=>"string"==typeof e,f=e=>{try{return p(e)&&(e=JSON.parse(e)),JSON.stringify(e)}catch(e){c(e)}};let d=void 0;const h=[];let m=!1,v="v0";const g=e=>"function"==typeof e,y=e=>t=>{if("Unknown Action"===t.data)return void c("Unknown Action",t);const[n,r]=(e=>{if(!p(e))return e;try{return JSON.parse(e)}catch(t){return e}})(t.data);let o=e;return n.split(".").forEach(e=>{const t=o[`${e}_done`];o=g(t)?t:o[e]}),g(o)?o(r):void 0},w=()=>{for(m=!0;h.length;){const e=h.shift();d.send(f(e))}},b=(e,t)=>{m=!1;try{d=new WebSocket(e)}catch(e){}d.onopen=w,d.onmessage=y(t),d.onclose=(()=>{m=!1,((e,t,n=1e3)=>new Promise(r=>{if(m&&d)return d;setTimeout(()=>{b(e,t),r()},n+=500)}))(e,t)})},k=(e={},t={},n=null)=>(Object.keys(t).forEach(r=>{const o=t[r],i=n?`${n}.${r}`:r;if("function"==typeof o)return e[r+"_done"]=o,void(e[r]=(e=>(t={})=>{t.jwt&&(e.jwt=t.jwt),N=[i,e],m&&d?("string"==typeof N[0]&&(N[0]=`${v}.${N[0]}`),d.send(f(N))):h.push(N)}));"object"!=typeof o||(e[r]=k(e[r],o,i))}),e);var N;const E=({error:e})=>{if(e&&0!==e.length)return"string"==typeof e?t("div",{style:{color:"red"}},[e]):Array.isArray(e)||"object"==typeof e?Object.keys(e).map(t=>E({error:`${t} ${JSON.stringify(e[t])}`})):void 0},j=e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`,S=({evt:e,state:t})=>{const n={};let r=!1;const o=e.currentTarget.getElementsByTagName("input");return Object.keys(t.inputs).filter(e=>"submit"!==t.inputs[e].type).map(e=>{const i=t.inputs[e];i.name=e,i.value=o[e].value;const u=(({input:e,inputs:t})=>{if(!e||"submit"===e.type||!e.name)return;const{name:n,value:r,type:o,required:i,max:u,min:a,equal:l}=e;let s=void 0;if(i&&!r?s="Please enter a value":a&&r.length<parseInt(a,10)?s=`${j(n)} is too short`:u&&r.length>parseInt(u,10)&&(s=`${j(n)} is too long`),"email"===o&&-1===r.indexOf("@")&&(s="Email must be valid"),l){const e=t[l].value;r&&e&&r===e||(s=`${j(l)}s must be equal`)}return s})({input:i,inputs:o});u&&(n.inputs=n.inputs||{},n.inputs[e]=u,r=!0)}),{errors:n,hasErrored:r}},x=e=>e.errors,O=({action:e,actions:n,state:r,title:o,submitValue:i})=>t("form",{novalidate:!0,action:r.action,method:r.method||"POST",onsubmit:((e,t)=>n=>{n.preventDefault();const{hasErrored:r,errors:o}=S({evt:n,state:t});if(r)return o;const i={};Object.keys(t.inputs).map(e=>{i[e]=t.inputs[e].value}),e(i)})(e,r),onchange:e=>n.validate({evt:e,state:r})},[o&&t("legend",null,[t("h2",null,[o])]),E({error:r.errors&&r.errors.submit}),t("fieldset",null,[Object.keys(r.inputs).map(e=>t("div",null,[((e={})=>t("input",{type:e.type||"text",placeholder:e.placeholder,min:e.min,max:e.max,equal:e.equal,required:e.required,name:e.name}))(Object.assign({name:e},r.inputs[e])),E({error:r.hasErrored&&r.errors.inputs[e]})]))]),t("input",{type:"submit",value:i||"Submit"})]);var $=k({location:s.actions,auth:{checkLogin:(e,t,n=!1)=>(...r)=>{n?e.user.jwt||t.location.go(e.auth.redirect.logout):e.user.jwt&&t.location.go(e.auth.redirect.login)}}.auth,forms:{login:{validate:S,handleError:x},register:{validate:S,handleError:x}}},{login:function(e){return function(t,n){return console.log("user login callback",{res:e,actions:n}),e.ok?(n.location.go("/profile"),{user:e.user}):{errors:e.errors}}},register:function(e){return function(){return console.log("register callback",{res:e}),e.ok?($.location.go("/profile"),{user:e.user}):{errors:e.errors}}},logout:function(e){return function(){return console.log({res:e}),e.ok?($.location.go("/login"),{user:{}}):{errors:e.errors}}}}),q={location:s.state,auth:{redirect:{logout:"/login",login:"/profile"}},counter:{value:0},user:{name:"",email:"",jwt:""},forms:{login:{action:"login",method:"POST",inputs:{name:{type:"text",placeholder:"Your username",min:6,required:!0},password:{type:"password",placeholder:"*********",min:6,noState:!0,required:!0}}},register:{action:"register",method:"POST",inputs:{name:{type:"text",placeholder:"Your username",min:6,required:!0},email:{type:"email",placeholder:"Your email",min:4,required:!0},password:{type:"password",placeholder:"*********",min:6,noState:!0,required:!0},password2:{type:"password",equal:"password",placeholder:"*********",min:6,noState:!0,required:!0}}}}},L=function(){return t("div",null,[t("h1",null,["Welcome."]),t("div",null,["This app is a simple login/registration example."])])},T=function(e){return t("li",null,[o({to:e.to},[e.text])])},P=function(e,t,n,r){var o,i=[].map,u=r&&r.children[0]||null,a=u&&function e(t){return{nodeName:t.nodeName.toLowerCase(),attributes:{},children:i.call(t.childNodes,function(t){return 3===t.nodeType?t.nodeValue:e(t)})}}(u),l=[],s=!0,c=m(e),p=function e(t,n,r){for(var o in r)"function"==typeof r[o]?function(e,o){r[e]=function(e){var i=o(e);return"function"==typeof i&&(i=i(g(t,c),r)),i&&i!==(n=g(t,c))&&!i.then&&h(c=v(t,m(n,i),c)),i}}(o,r[o]):e(t.concat(o),n[o]=m(n[o]),r[o]=m(r[o]));return r}([],c,m(t));return h(),p;function f(e){return"function"==typeof e?f(e(c,p)):null!=e?e:""}function d(){o=!o;var e=f(n);for(r&&!o&&(u=function e(t,n,r,o,i){if(o===r);else if(null==r||r.nodeName!==o.nodeName){var u=function e(t,n){var r="string"==typeof t||"number"==typeof t?document.createTextNode(t):(n=n||"svg"===t.nodeName)?document.createElementNS("http://www.w3.org/2000/svg",t.nodeName):document.createElement(t.nodeName),o=t.attributes;if(o){o.oncreate&&l.push(function(){o.oncreate(r)});for(var i=0;i<t.children.length;i++)r.appendChild(e(t.children[i]=f(t.children[i]),n));for(var u in o)b(r,u,o[u],null,n)}return r}(o,i);t.insertBefore(u,n),null!=r&&k(t,n,r),n=u}else if(null==r.nodeName)n.nodeValue=o;else{!function(e,t,n,r){for(var o in m(t,n))n[o]!==("value"===o||"checked"===o?e[o]:t[o])&&b(e,o,n[o],t[o],r);var i=s?n.oncreate:n.onupdate;i&&l.push(function(){i(e,t)})}(n,r.attributes,o.attributes,i=i||"svg"===o.nodeName);for(var a={},c={},p=[],d=r.children,h=o.children,v=0;v<d.length;v++){p[v]=n.childNodes[v];var g=y(d[v]);null!=g&&(a[g]=[p[v],d[v]])}for(var v=0,w=0;w<h.length;){var g=y(d[v]),N=y(h[w]=f(h[w]));if(c[g])v++;else if(null==N||s)null==g&&(e(n,p[v],d[v],h[w],i),w++),v++;else{var E=a[N]||[];g===N?(e(n,E[0],E[1],h[w],i),v++):E[0]?e(n,n.insertBefore(E[0],p[v]),E[1],h[w],i):e(n,p[v],null,h[w],i),c[N]=h[w],w++}}for(;v<d.length;)null==y(d[v])&&k(n,p[v],d[v]),v++;for(var v in a)c[v]||k(n,a[v][0],a[v][1])}return n}(r,u,a,a=e)),s=!1;l.length;)l.pop()()}function h(){o||(o=!0,setTimeout(d))}function m(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n}function v(e,t,n){var r={};return e.length?(r[e[0]]=e.length>1?v(e.slice(1),t,n[e[0]]):t,m(n,r)):t}function g(e,t){for(var n=0;n<e.length;)t=t[e[n++]];return t}function y(e){return e?e.key:null}function w(e){return e.currentTarget.events[e.type](e)}function b(e,t,n,r,o){if("key"===t);else if("style"===t)for(var i in m(r,n)){var u=null==n||null==n[i]?"":n[i];"-"===i[0]?e[t].setProperty(i,u):e[t][i]=u}else"o"===t[0]&&"n"===t[1]?(t=t.slice(2),e.events?r||(r=e.events[t]):e.events={},e.events[t]=n,n?r||e.addEventListener(t,w):e.removeEventListener(t,w)):t in e&&"list"!==t&&!o?e[t]=null==n?"":n:null!=n&&!1!==n&&e.setAttribute(t,n),null!=n&&!1!==n||e.removeAttribute(t)}function k(e,t,n){function r(){e.removeChild(function e(t,n){var r=n.attributes;if(r){for(var o=0;o<n.children.length;o++)e(t.childNodes[o],n.children[o]);r.ondestroy&&r.ondestroy(t)}return t}(t,n))}var o=n.attributes&&n.attributes.onremove;o?o(t,r):r()}}(q,$,function(e,n){return t("div",null,[(r={user:e.user,logout:n.logout},i=r.user,u=r.logout,t("ul",null,[t("li",null,[o({to:"/"},["Home"])]),!i.jwt&&T({to:"/login",text:"Login"}),!i.jwt&&T({to:"/register",text:"Register"}),i.jwt&&T({to:"/profile",text:"Profile"}),i.jwt&&t("li",null,[t("a",{onclick:u},["Logout"])])])),l({path:"/login",render:function(e,n){return function(r){return t("div",{oncreate:n.checkLoggedIn},[t("h2",null,["Login"]),O({state:e.forms.login,actions:n.forms.login,app:{state:e,actions:n},action:n.login})])}}(e,n)}),l({path:"/register",render:function(e,n){return function(){return t("div",null,[t("h1",null,["Register"]),O({actions:n.forms.register,state:e.forms.register,app:{state:e,actions:n},action:n.register})])}}(e,n)}),l({path:"/profile",render:function(e,n){return function(n){return t("div",null,[t("h2",null,["Profile"]),t("div",null,["Name: ",e.user.name]),t("div",null,["Email: ",e.user.email])])}}(e)}),l({path:"/",render:L}),l({path:"*",render:function(){return t("div",null,["404 - Not found"])}}),JSON.stringify(e)]);var r,i,u},document.body),A=((e,t={})=>{const n=t.host||location.hostname,r=t.port||location.port,o=t.protocol||"ws";return v=t.apiVersion||v||"v0",b(`${o}://${n}:${r}`,e),d})(P,{host:"localhost",protocol:"ws",port:3001,state:q}),C=s.subscribe(P.location);return e.connected=P,e.ws=A,e.router=C,e}({});
//# sourceMappingURL=bundle.js.map
