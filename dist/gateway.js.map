{"version":3,"file":"gateway.js","sources":["../node_modules/@hyperapp/render/node/module.js","../node_modules/@hyperapp/router/src/parseRoute.js","../node_modules/@hyperapp/router/src/location.js"],"sourcesContent":["/*! Hyperapp Render | MIT Licence | https://github.com/hyperapp/render */\n\nimport { Readable } from 'stream';\n\nvar styleNameCache = new Map();\nvar uppercasePattern = /([A-Z])/g;\nvar msPattern = /^ms-/;\nvar voidElements = new Set(['area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'link', 'meta', 'param', 'source', 'track', 'wbr']);\nvar ignoreAttributes = new Set(['key', 'innerHTML', '__source']);\nvar escapeRegExp = /[\"&'<>]/g;\nvar escapeLookup = new Map([['\"', '&quot;'], ['&', '&amp;'], [\"'\", '&#39;'], ['<', '&lt;'], ['>', '&gt;']]);\n\nfunction escaper(match) {\n  return escapeLookup.get(match);\n}\n\nfunction escapeHtml(value) {\n  if (typeof value === 'number') {\n    return '' + value;\n  }\n\n  return ('' + value).replace(escapeRegExp, escaper);\n}\n\nfunction hyphenateStyleName(styleName) {\n  return styleNameCache.get(styleName) || styleNameCache.set(styleName, styleName.replace(uppercasePattern, '-$&').toLowerCase().replace(msPattern, '-ms-')).get(styleName);\n}\n\nfunction stringifyStyles(styles) {\n  var out = '';\n  var delimiter = '';\n  var styleNames = Object.keys(styles);\n\n  for (var i = 0; i < styleNames.length; i++) {\n    var styleName = styleNames[i];\n    var styleValue = styles[styleName];\n\n    if (styleValue != null) {\n      if (styleName === 'cssText') {\n        out += delimiter + styleValue;\n      } else {\n        out += delimiter + hyphenateStyleName(styleName) + ':' + styleValue;\n      }\n\n      delimiter = ';';\n    }\n  }\n\n  return out || null;\n}\n\nfunction renderFragment(_ref, stack) {\n  var nodeName = _ref.nodeName,\n      attributes = _ref.attributes,\n      children = _ref.children;\n  var out = '';\n  var footer = '';\n\n  if (nodeName) {\n    out += '<' + nodeName;\n    var keys = Object.keys(attributes);\n\n    for (var i = 0; i < keys.length; i++) {\n      var name = keys[i];\n      var value = attributes[name];\n\n      if (name === 'style' && value && typeof value === 'object') {\n        value = stringifyStyles(value);\n      }\n\n      if (value != null && value !== false && typeof value !== 'function' && !ignoreAttributes.has(name)) {\n        out += ' ' + name;\n\n        if (value !== true) {\n          out += '=\"' + escapeHtml(value) + '\"';\n        }\n      }\n    }\n\n    if (voidElements.has(nodeName)) {\n      out += '/>';\n    } else {\n      out += '>';\n      footer = '</' + nodeName + '>';\n    }\n  }\n\n  var innerHTML = attributes.innerHTML;\n\n  if (innerHTML != null) {\n    out += innerHTML;\n  }\n\n  if (children.length > 0) {\n    stack.push({\n      childIndex: 0,\n      children: children,\n      footer: footer\n    });\n  } else {\n    out += footer;\n  }\n\n  return out;\n}\n\nfunction resolveNode(node, state, actions) {\n  if (typeof node === 'function') {\n    return resolveNode(node(state, actions), state, actions);\n  }\n\n  return node;\n}\n\nfunction renderer(view, state, actions) {\n  var stack = [{\n    childIndex: 0,\n    children: [view],\n    footer: ''\n  }];\n  var end = false;\n  return function (bytes) {\n    if (end) {\n      return null;\n    }\n\n    var out = '';\n\n    while (out.length < bytes) {\n      if (stack.length === 0) {\n        end = true;\n        break;\n      }\n\n      var frame = stack[stack.length - 1];\n\n      if (frame.childIndex >= frame.children.length) {\n        out += frame.footer;\n        stack.pop();\n      } else {\n        var node = resolveNode(frame.children[frame.childIndex++], state, actions);\n\n        if (node != null && typeof node !== 'boolean') {\n          if (node.pop) {\n            stack.push({\n              childIndex: 0,\n              children: node,\n              footer: ''\n            });\n          } else if (node.attributes) {\n            out += renderFragment(node, stack);\n          } else {\n            out += escapeHtml(node);\n          }\n        }\n      }\n    }\n\n    return out;\n  };\n}\nfunction renderToString(view, state, actions) {\n  return renderer(view, state, actions)(Infinity);\n}\n\nfunction renderToStream(view, state, actions) {\n  var _read = renderer(view, state, actions);\n\n  return new Readable({\n    read: function read(size) {\n      try {\n        this.push(_read(size));\n      } catch (err) {\n        this.emit('error', err);\n      }\n    }\n  });\n}\nfunction withRender$1(nextApp) {\n  return function (initialState, actionsTemplate, view, container) {\n    var actions = nextApp(initialState, Object.assign({}, actionsTemplate, {\n      getState: function getState() {\n        return function (state) {\n          return state;\n        };\n      }\n    }), view, container);\n\n    actions.toString = function () {\n      return renderToString(view, actions.getState(), actions);\n    };\n\n    actions.toStream = function () {\n      return renderToStream(view, actions.getState(), actions);\n    };\n\n    return actions;\n  };\n}\n\nexport { renderer, renderToString, renderToStream, withRender$1 as withRender };\n//# sourceMappingURL=module.js.map\n","function createMatch(isExact, path, url, params) {\n  return {\n    isExact: isExact,\n    path: path,\n    url: url,\n    params: params\n  }\n}\n\nfunction trimTrailingSlash(url) {\n  for (var len = url.length; \"/\" === url[--len]; );\n  return url.slice(0, len + 1)\n}\n\nfunction decodeParam(val) {\n  try {\n    return decodeURIComponent(val)\n  } catch (e) {\n    return val\n  }\n}\n\nexport function parseRoute(path, url, options) {\n  if (path === url || !path) {\n    return createMatch(path === url, path, url)\n  }\n\n  var exact = options && options.exact\n  var paths = trimTrailingSlash(path).split(\"/\")\n  var urls = trimTrailingSlash(url).split(\"/\")\n\n  if (paths.length > urls.length || (exact && paths.length < urls.length)) {\n    return\n  }\n\n  for (var i = 0, params = {}, len = paths.length, url = \"\"; i < len; i++) {\n    if (\":\" === paths[i][0]) {\n      params[paths[i].slice(1)] = urls[i] = decodeParam(urls[i])\n    } else if (paths[i] !== urls[i]) {\n      return\n    }\n    url += urls[i] + \"/\"\n  }\n\n  return createMatch(false, path, url.slice(0, -1), params)\n}\n","function wrapHistory(keys) {\n  return keys.reduce(function(next, key) {\n    var fn = history[key]\n\n    history[key] = function(data, title, url) {\n      fn.call(this, data, title, url)\n      dispatchEvent(new CustomEvent(\"pushstate\", { detail: data }))\n    }\n\n    return function() {\n      history[key] = fn\n      next && next()\n    }\n  }, null)\n}\n\nexport var location = {\n  state: {\n    pathname: window.location.pathname,\n    previous: window.location.pathname\n  },\n  actions: {\n    go: function(pathname) {\n      history.pushState(null, \"\", pathname)\n    },\n    set: function(data) {\n      return data\n    }\n  },\n  subscribe: function(actions) {\n    function handleLocationChange(e) {\n      actions.set({\n        pathname: window.location.pathname,\n        previous: e.detail\n          ? (window.location.previous = e.detail)\n          : window.location.previous\n      })\n    }\n\n    var unwrap = wrapHistory([\"pushState\", \"replaceState\"])\n\n    addEventListener(\"pushstate\", handleLocationChange)\n    addEventListener(\"popstate\", handleLocationChange)\n\n    return function() {\n      removeEventListener(\"pushstate\", handleLocationChange)\n      removeEventListener(\"popstate\", handleLocationChange)\n      unwrap()\n    }\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}